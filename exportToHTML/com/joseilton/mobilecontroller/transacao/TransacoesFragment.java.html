<html>
<head>
<title>TransacoesFragment.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #606366; font-weight: normal; font-style: normal; }
.s0 { color: rgb(204,120,50); }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(106,135,89); }
.s3 { color: rgb(128,128,128); }
.s4 { color: rgb(104,151,187); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
TransacoesFragment.java</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">package </span><span class="s1">com.joseilton.mobilecontroller.transacao</span><span class="s0">;</span><span class="s1"> 
 
</span><span class="s0">import </span><span class="s1">android.annotation.SuppressLint</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.content.Intent</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.os.Bundle</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.support.annotation.Nullable</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.support.v4.app.Fragment</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.support.v7.app.AlertDialog</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.support.v7.widget.LinearLayoutManager</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.support.v7.widget.RecyclerView</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.support.v7.widget.Toolbar</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.util.Log</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.view.LayoutInflater</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.view.Menu</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.view.MenuInflater</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.view.MenuItem</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.view.View</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.view.ViewGroup</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.widget.ImageButton</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">android.widget.TextView</span><span class="s0">;</span><span class="s1"> 
 
</span><span class="s0">import </span><span class="s1">com.jjoe64.graphview.GraphView</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.jjoe64.graphview.helper.StaticLabelsFormatter</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.jjoe64.graphview.series.BarGraphSeries</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.jjoe64.graphview.series.DataPoint</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.joseilton.mobilecontroller.R</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.joseilton.mobilecontroller.app.RecyclerTouchListener</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.joseilton.mobilecontroller.categoria.CategoriasActivity</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.joseilton.mobilecontroller.util.ColorUtil</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.joseilton.mobilecontroller.util.DateUtil</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.joseilton.mobilecontroller.util.MensagemUtil</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">com.joseilton.mobilecontroller.util.PeriodoUtil</span><span class="s0">;</span><span class="s1"> 
 
</span><span class="s0">import </span><span class="s1">java.math.BigDecimal</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">java.sql.SQLException</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">java.util.Date</span><span class="s0">;</span><span class="s1"> 
</span><span class="s0">import </span><span class="s1">java.util.List</span><span class="s0">;</span><span class="s1"> 
 
 
</span><span class="s0">public class </span><span class="s1">TransacoesFragment </span><span class="s0">extends </span><span class="s1">Fragment </span><span class="s0">implements </span><span class="s1">View.OnClickListener { 
    </span><span class="s0">private final static </span><span class="s1">String TAG = </span><span class="s2">&quot;TransacoesFragment.&quot;</span><span class="s0">;</span><span class="s1"> 
 
    </span><span class="s0">private </span><span class="s1">RecyclerView recyclerView</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">List&lt;Transacao&gt; transacoes</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">Toolbar mToolbar</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">Transacao transacao</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">TransacaoService mService</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">TransacoesAdapter mAdapter</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">Date dataFiltro</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">ImageButton previousImageButton</span><span class="s0">, </span><span class="s1">nextImageButton</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">TextView filtroTextView</span><span class="s0">;</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">View mView</span><span class="s0">;</span><span class="s1"> 
 
    @Nullable 
    @Override 
    </span><span class="s0">public </span><span class="s1">View onCreateView(LayoutInflater inflater</span><span class="s0">, </span><span class="s1">ViewGroup container</span><span class="s0">, </span><span class="s1">Bundle savedInstanceState) { 
        mView = inflater.inflate(R.layout.transacoes_fragment</span><span class="s0">, </span><span class="s1">container</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
 
        setHasOptionsMenu(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
 
        setupToolbar()</span><span class="s0">;</span><span class="s1"> 
 
        setupViews()</span><span class="s0">;</span><span class="s1"> 
        dataFiltro = </span><span class="s0">new </span><span class="s1">Date()</span><span class="s0">;</span><span class="s1"> 
        filtroTextView.setText(DateUtil.getMonthAndYear(dataFiltro))</span><span class="s0">;</span><span class="s1"> 
        filtroTextView.setOnClickListener(</span><span class="s0">this</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        getTransacoes()</span><span class="s0">;</span><span class="s1"> 
        setupRecyclerView()</span><span class="s0">;</span><span class="s1"> 
 
        </span><span class="s0">return </span><span class="s1">mView</span><span class="s0">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">private void </span><span class="s1">setupToolbar() { 
        </span><span class="s0">if</span><span class="s1">(mToolbar == </span><span class="s0">null</span><span class="s1">) 
            mToolbar = (Toolbar) getActivity().findViewById(R.id.toolbar)</span><span class="s0">;</span><span class="s1"> 
 
        mToolbar.setTitle(getString(R.string.title_transacoes))</span><span class="s0">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">private void </span><span class="s1">setupRecyclerView() { 
        recyclerView = (RecyclerView) mView.findViewById(R.id.transacoes_recyclerView)</span><span class="s0">;</span><span class="s1"> 
        mAdapter = </span><span class="s0">new </span><span class="s1">TransacoesAdapter(transacoes)</span><span class="s0">;</span><span class="s1"> 
        RecyclerView.LayoutManager mLayoutManager = </span><span class="s0">new </span><span class="s1">LinearLayoutManager(getActivity().getApplicationContext())</span><span class="s0">;</span><span class="s1"> 
        recyclerView.setLayoutManager(mLayoutManager)</span><span class="s0">;</span><span class="s1"> 
        </span><span class="s3">//recyclerView.addItemDecoration(new DividerItemDecoration(getActivity(), LinearLayout.VERTICAL));</span><span class="s1"> 
        </span><span class="s3">//recyclerView.setItemAnimator(new DefaultItemAnimator());</span><span class="s1"> 
        recyclerView.setAdapter(mAdapter)</span><span class="s0">;</span><span class="s1"> 
        recyclerView.addOnItemTouchListener( 
                </span><span class="s0">new </span><span class="s1">RecyclerTouchListener(getActivity() 
                        .getApplicationContext()</span><span class="s0">, </span><span class="s1">recyclerView</span><span class="s0">, new </span><span class="s1">RecyclerTouchListener.ClickListener() { 
                    @Override 
                    </span><span class="s0">public void </span><span class="s1">onClick(View view</span><span class="s0">, int </span><span class="s1">position) { 
 
                        transacao = transacoes.get(position)</span><span class="s0">;</span><span class="s1"> 
                        Intent intent = </span><span class="s0">new </span><span class="s1">Intent(getActivity()</span><span class="s0">, </span><span class="s1">DetalhesTransacaoActivity.</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
                        intent.putExtra(</span><span class="s2">&quot;transacao&quot;</span><span class="s0">, </span><span class="s1">transacao)</span><span class="s0">;</span><span class="s1"> 
                        startActivity(intent)</span><span class="s0">;</span><span class="s1"> 
 
                    } 
 
                    @Override 
                    </span><span class="s0">public void </span><span class="s1">onLongClick(View view</span><span class="s0">, int </span><span class="s1">position) { 
                        onClick(view</span><span class="s0">, </span><span class="s1">position)</span><span class="s0">;</span><span class="s1"> 
                    } 
                }) 
        )</span><span class="s0">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">private void </span><span class="s1">setupViews() { 
        previousImageButton = (ImageButton) mView.findViewById(R.id.previous_imageButton)</span><span class="s0">;</span><span class="s1"> 
        previousImageButton.setOnClickListener(</span><span class="s0">this</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        nextImageButton = (ImageButton) mView.findViewById(R.id.next_imageButton)</span><span class="s0">;</span><span class="s1"> 
        nextImageButton.setOnClickListener(</span><span class="s0">this</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        filtroTextView = (TextView) mView.findViewById(R.id.filtro_textView)</span><span class="s0">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">public void </span><span class="s1">previousImageButtonAction() { 
        Date d = dataFiltro</span><span class="s0">;</span><span class="s1"> 
        dataFiltro = DateUtil.addMes(d</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        filtroTextView.setText(DateUtil.getMonthAndYear(dataFiltro))</span><span class="s0">;</span><span class="s1"> 
        getTransacoes()</span><span class="s0">;</span><span class="s1"> 
        release()</span><span class="s0">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">public void </span><span class="s1">nextImageButtonAction() { 
        Date d = dataFiltro</span><span class="s0">;</span><span class="s1"> 
        dataFiltro = DateUtil.addMes(d</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        filtroTextView.setText(DateUtil.getMonthAndYear(dataFiltro))</span><span class="s0">;</span><span class="s1"> 
        getTransacoes()</span><span class="s0">;</span><span class="s1"> 
        release()</span><span class="s0">;</span><span class="s1"> 
    } 
 
    @SuppressLint(</span><span class="s2">&quot;LongLogTag&quot;</span><span class="s1">) 
    </span><span class="s0">private void </span><span class="s1">getTransacoes() { 
        </span><span class="s0">try </span><span class="s1">{ 
            mService = </span><span class="s0">new </span><span class="s1">TransacaoService(getActivity())</span><span class="s0">;</span><span class="s1"> 
            transacoes = mService.getTransacoesPeriodo(PeriodoUtil.thisMonth(dataFiltro)</span><span class="s0">, null</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        } </span><span class="s0">catch </span><span class="s1">(SQLException e) { 
            Log.e(TAG + 
                    </span><span class="s2">&quot;getTransacoes()&quot;</span><span class="s0">, </span><span class="s2">&quot;Erro: &quot; </span><span class="s1">+ e.getMessage())</span><span class="s0">;</span><span class="s1"> 
            e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
            MensagemUtil.getMensagem(getActivity().getApplicationContext()</span><span class="s0">, </span><span class="s1">e)</span><span class="s0">;</span><span class="s1"> 
        } 
    } 
 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onResume() { 
        </span><span class="s0">super</span><span class="s1">.onResume()</span><span class="s0">;</span><span class="s1"> 
        getTransacoes()</span><span class="s0">;</span><span class="s1"> 
        release()</span><span class="s0">;</span><span class="s1"> 
    } 
 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onCreateOptionsMenu(Menu menu</span><span class="s0">, </span><span class="s1">MenuInflater inflater) { 
        </span><span class="s0">super</span><span class="s1">.onCreateOptionsMenu(menu</span><span class="s0">, </span><span class="s1">inflater)</span><span class="s0">;</span><span class="s1"> 
        menu.clear()</span><span class="s0">;</span><span class="s1"> 
        inflater.inflate(R.menu.menu_transacoes</span><span class="s0">, </span><span class="s1">menu)</span><span class="s0">;</span><span class="s1"> 
    } 
 
    @Override 
    </span><span class="s0">public boolean </span><span class="s1">onOptionsItemSelected(MenuItem item) { 
        </span><span class="s3">// Handle action bar item clicks here. The action bar will</span><span class="s1"> 
        </span><span class="s3">// automatically handle clicks on the Home/Up button, so long</span><span class="s1"> 
        </span><span class="s3">// as you specify a parent activity in AndroidManifest.xml.</span><span class="s1"> 
        </span><span class="s0">int </span><span class="s1">id = item.getItemId()</span><span class="s0">;</span><span class="s1"> 
 
        </span><span class="s3">//noinspection SimplifiableIfStatement</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(id == R.id.action_novo) { 
            transacao = </span><span class="s0">new </span><span class="s1">Transacao()</span><span class="s0">;</span><span class="s1"> 
            Intent intent = </span><span class="s0">new </span><span class="s1">Intent(getActivity()</span><span class="s0">, </span><span class="s1">DetalhesTransacaoActivity.</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
            intent.putExtra(</span><span class="s2">&quot;transacao&quot;</span><span class="s0">, </span><span class="s1">transacao)</span><span class="s0">;</span><span class="s1"> 
            startActivity(intent)</span><span class="s0">;</span><span class="s1"> 
 
        } </span><span class="s0">else if </span><span class="s1">(id == R.id.action_categorias) { 
            startActivity(</span><span class="s0">new </span><span class="s1">Intent(getActivity()</span><span class="s0">, </span><span class="s1">CategoriasActivity.</span><span class="s0">class</span><span class="s1">))</span><span class="s0">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return super</span><span class="s1">.onOptionsItemSelected(item)</span><span class="s0">;</span><span class="s1"> 
    } 
 
    </span><span class="s0">private void </span><span class="s1">release() { 
        mAdapter = </span><span class="s0">new </span><span class="s1">TransacoesAdapter(transacoes)</span><span class="s0">;</span><span class="s1"> 
        recyclerView.setAdapter(mAdapter)</span><span class="s0">;</span><span class="s1"> 
    } 
 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onClick(View view) { 
       </span><span class="s0">if </span><span class="s1">(view.getId() == R.id.previous_imageButton) { 
            previousImageButtonAction()</span><span class="s0">;</span><span class="s1"> 
        } </span><span class="s0">else if </span><span class="s1">(view.getId() == R.id.next_imageButton) { 
            nextImageButtonAction()</span><span class="s0">;</span><span class="s1"> 
        } </span><span class="s0">else if </span><span class="s1">(view.getId() == R.id.filtro_textView) { 
            startGraphLayout()</span><span class="s0">;</span><span class="s1"> 
        } 
    } 
 
    </span><span class="s0">private void </span><span class="s1">startGraphLayout() { 
 
        View view</span><span class="s0">;</span><span class="s1"> 
 
        BigDecimal despesaTotal = </span><span class="s0">new </span><span class="s1">BigDecimal(</span><span class="s2">&quot;0.00&quot;</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        BigDecimal receitaTotal = </span><span class="s0">new </span><span class="s1">BigDecimal(</span><span class="s2">&quot;0.00&quot;</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
 
        </span><span class="s0">for</span><span class="s1">(Transacao t : transacoes) { 
            </span><span class="s0">if</span><span class="s1">(t.getTipo() == TransacaoTipo.Despesa) { 
                despesaTotal = despesaTotal.add(t.getValor())</span><span class="s0">;</span><span class="s1"> 
            } </span><span class="s0">else </span><span class="s1">{ 
                receitaTotal = receitaTotal.add(t.getValor())</span><span class="s0">;</span><span class="s1"> 
            } 
        } 
 
        AlertDialog.Builder builder = </span><span class="s0">new </span><span class="s1">AlertDialog.Builder(getActivity())</span><span class="s0">;</span><span class="s1"> 
        LayoutInflater inflater = getActivity().getLayoutInflater()</span><span class="s0">;</span><span class="s1"> 
        view = inflater.inflate(R.layout.transacao_graph</span><span class="s0">, null</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        builder.setView(view) 
                .setNegativeButton(getString(R.string.label_action_sair)</span><span class="s0">, </span><span class="s1">(dialog</span><span class="s0">, </span><span class="s1">which) -&gt; { 
 
                } 
        )</span><span class="s0">;</span><span class="s1"> 
 
        GraphView graph = (GraphView) view.findViewById(R.id.graph)</span><span class="s0">;</span><span class="s1"> 
        BarGraphSeries&lt;DataPoint&gt; series = </span><span class="s0">new </span><span class="s1">BarGraphSeries&lt;&gt;(</span><span class="s0">new </span><span class="s1">DataPoint[] { 
                </span><span class="s0">new </span><span class="s1">DataPoint(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">Double.parseDouble(String.valueOf(receitaTotal)))</span><span class="s0">,</span><span class="s1"> 
                </span><span class="s0">new </span><span class="s1">DataPoint(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">Double.parseDouble(String.valueOf(despesaTotal)))</span><span class="s0">,</span><span class="s1"> 
 
        })</span><span class="s0">;</span><span class="s1"> 
 
        StaticLabelsFormatter staticLabelsFormatter = </span><span class="s0">new </span><span class="s1">StaticLabelsFormatter(graph)</span><span class="s0">;</span><span class="s1"> 
        staticLabelsFormatter.setHorizontalLabels(</span><span class="s0">new </span><span class="s1">String[] {</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s1">getString(R.string.label_transacao_receita)</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s1">getString(R.string.label_transacao_despesa)</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">})</span><span class="s0">;</span><span class="s1"> 
 
        graph.setTitle(getString(R.string.label_receita_x_despesa))</span><span class="s0">;</span><span class="s1"> 
        graph.setTitleTextSize(</span><span class="s4">60</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        graph.getViewport().setMaxX(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        graph.getViewport().setMinX(</span><span class="s4">0</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        graph.getGridLabelRenderer().setLabelFormatter(staticLabelsFormatter)</span><span class="s0">;</span><span class="s1"> 
 
        series.setDrawValuesOnTop(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        series.setValuesOnTopColor(ColorUtil.BLACK)</span><span class="s0">;</span><span class="s1"> 
        series.setValueDependentColor(data -&gt; { 
            </span><span class="s0">int </span><span class="s1">color = </span><span class="s4">0</span><span class="s0">;</span><span class="s1"> 
            </span><span class="s0">if</span><span class="s1">(data.getX() == </span><span class="s4">1</span><span class="s1">) { 
                color = ColorUtil.DARK_GREEN</span><span class="s0">;</span><span class="s1"> 
            } </span><span class="s0">else if</span><span class="s1">(data.getX() == </span><span class="s4">3</span><span class="s1">) { 
                color =  ColorUtil.DARK_RED</span><span class="s0">;</span><span class="s1"> 
            } 
            </span><span class="s0">return </span><span class="s1">color</span><span class="s0">;</span><span class="s1"> 
        })</span><span class="s0">;</span><span class="s1"> 
        series.setSpacing(</span><span class="s4">20</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        series.setAnimated(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
        graph.addSeries(series)</span><span class="s0">;</span><span class="s1"> 
 
        AlertDialog alertDialog = builder.create()</span><span class="s0">;</span><span class="s1"> 
        alertDialog.show()</span><span class="s0">;</span><span class="s1"> 
    } 
 
 
} 
</span></pre>
</body>
</html>